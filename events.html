<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b0b0b" />
  <title>Calendar | Dr Rihana Speaks</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
<a class="skip-link" href="#main">Skip to content</a>
<header class="site-header">
  <div class="container navbar">
    <a class="brand" href="index.html" aria-label="Dr Rihana Speaks home">
      <img src="assets/images/logo-dr-rihana.png" alt="Dr Rihana Speaks Logo" class="brand-logo">
    </a>

    <nav class="nav-links" aria-label="Primary">
      <a data-nav href="index.html">Home</a>
      <a data-nav href="books.html">Books</a>
      <a data-nav href="speaking.html">Speaking</a>
      <a data-nav href="events.html">Calendar</a>
    </nav>
</div>
</header>

<main id="main">

<section class="hero" style="padding-bottom:18px">
  <div class="container">
    <div class="kicker"><span class="dot"></span>Calendar</div>
    <h1>Speaking events calendar</h1>
    <p class="lead">Month view plus a simple list view for quick scanning.</p>
  </div>
</section>

<section>
  <div class="container">
    <div class="notice">
      <strong>Edit events:</strong> open <code>/assets/js/events.js</code> and update the <code>window.DRS_EVENTS</code> array.
    </div>

    <div id="calendar" class="card" style="padding:14px"></div>

      <div style="margin-top:16px" id="eventList"></div>

    <div class="card" style="margin-top:16px">
      <h3 style="margin-top:0">Upcoming (list view)</h3>
      <div class="help">This list is generated from the same events data.</div>
      <div id="eventsList" style="margin-top:12px"></div>
    </div>
  </div>
</section>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.global.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.global.min.js"></script>
<script src="assets/js/events.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');
  const listEl = document.getElementById('eventList');

  async function getEvents() {
    try {
      const res = await fetch('assets/data/events.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('Failed to load events.json');
      const data = await res.json();
      if (Array.isArray(data)) return data;
      if (data && Array.isArray(data.events)) return data.events;
      return [];
    } catch (e) {
      // Fallback if JSON isn't available yet
      return (window.DRS_EVENTS || []).slice();
    }
  }

  function renderList(events) {
    if (!listEl) return;
    if (!events.length) {
      listEl.innerHTML = '<div class="help">No events listed yet.</div>';
      return;
    }

    const sorted = events.slice().sort((a,b) => (a.start || '').localeCompare(b.start || ''));
    listEl.innerHTML = sorted.map(ev => {
      const start = ev.start ? new Date(ev.start).toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric' }) : '';
      const title = ev.title || 'Event';
      const where = ev.location ? ` • ${ev.location}` : '';
      const linkOpen = ev.url ? `<a href="${ev.url}" target="_blank" rel="noopener">Details →</a>` : '';
      return `<div class="card" style="padding:14px">
        <div style="display:flex;justify-content:space-between;gap:14px;align-items:baseline;flex-wrap:wrap">
          <div><strong>${title}</strong><div class="help">${start}${where}</div></div>
          <div>${linkOpen}</div>
        </div>
      </div>`;
    }).join('');
  }

  getEvents().then(events => {
    const cal = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      height: 'auto',
      events,
      eventClick: function(info) {
        if (info.event.url) {
          info.jsEvent.preventDefault();
          window.open(info.event.url, '_blank', 'noopener');
        }
      }
    });
    cal.render();
    renderList(events);
  });
});
</script>

</main>

<footer class="footer">
  <div class="container footer-grid">
    <div>
      <div class="brand-name">Dr Rihana Speaks</div>
      <small>© <span data-year></span> Dr Rihana Speaks. All rights reserved.</small>
      <div style="margin-top:10px" class="help">
        Built with Netlify. Speaking requests submit through Netlify Forms.
      </div>
    </div>
</div>
</footer>

<script src="assets/js/main.js"></script>
</body>
</html>
